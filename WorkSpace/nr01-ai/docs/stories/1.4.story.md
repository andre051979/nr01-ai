---
id: "1.4"
title: "Diagn√≥stico ‚Äî Question√°rio de Riscos Psicossociais por Setor"
epic: 1
story: 4
status: Draft
priority: high
type: fullstack
created: 2026-02-25
updated: 2026-02-25
blockedBy: ["1.3"]
---

# Story 1.4: Diagn√≥stico ‚Äî Question√°rio de Riscos Psicossociais por Setor

## Status: Draft

## Story Statement

Como administrador, quero aplicar um question√°rio de riscos psicossociais para cada setor da empresa usando uma escala Likert de 1 a 5, para que o sistema possa identificar e quantificar os riscos por √°rea.

## Acceptance Criteria

- [ ] **AC1:** Aba "Question√°rio" do stepper acess√≠vel ap√≥s empresa cadastrada
- [ ] **AC2:** Seletor de setor no topo ‚Äî navegar entre setores da empresa
- [ ] **AC3:** 15 perguntas exibidas, agrupadas por 5 categorias (3 por categoria): Organiza√ß√£o do Trabalho, Rela√ß√µes Interpessoais, Condi√ß√µes de Trabalho, Viol√™ncia e Ass√©dio, Reconhecimento e Recompensa
- [ ] **AC4:** Cada pergunta usa escala Likert visual com 5 op√ß√µes rotuladas: 1=Nunca, 2=Raramente, 3=√Äs vezes, 4=Frequentemente, 5=Sempre
- [ ] **AC5:** Respostas salvas automaticamente (auto-save) ao selecionar cada valor ‚Äî sem bot√£o "Salvar" manual
- [ ] **AC6:** Indicador de progresso por setor: "X de 15 perguntas respondidas"
- [ ] **AC7:** Setor marcado como "completo" quando todas as 15 perguntas forem respondidas
- [ ] **AC8:** Bot√£o "Pr√≥ximo Setor" ‚Äî dispon√≠vel ap√≥s completar setor atual; para √∫ltimo setor exibe "Concluir Question√°rio"
- [ ] **AC9:** Respostas persistem ao reentrar ‚Äî question√°rio j√° respondido exibe valores salvos
- [ ] **AC10:** N√£o √© poss√≠vel prosseguir para Evid√™ncias sem todos os setores com 15/15 respostas

## Tasks / Subtasks

- [ ] **Task 1:** Criar API Routes de question√°rio (AC: 5, 9)
  - [ ] `GET /api/questionario/perguntas` ‚Äî lista perguntas ativas ordenadas
  - [ ] `GET /api/questionario/respostas?setorId=X` ‚Äî respostas do setor
  - [ ] `POST /api/questionario/resposta` ‚Äî salva/atualiza resposta individual (upsert)
  - [ ] Valida√ß√£o: valor entre 1 e 5, setorId pertence √† empresa do usu√°rio

- [ ] **Task 2:** Criar componente de seletor de setor (AC: 2, 7)
  - [ ] `SetorSelector` ‚Äî dropdown ou tabs com lista de setores
  - [ ] Badge de status: "Completo ‚úì" ou "X/15"
  - [ ] Highlight do setor atual

- [ ] **Task 3:** Criar componente Likert Scale (AC: 4)
  - [ ] `LikertScale` ‚Äî 5 bot√µes radiais estilizados
  - [ ] Labels: 1=Nunca, 2=Raramente, 3=√Äs vezes, 4=Frequentemente, 5=Sempre
  - [ ] Cor de destaque ao selecionar (escala de verde claro a vermelho)
  - [ ] Acessibilidade: role="radiogroup", aria-label

- [ ] **Task 4:** Criar componente de grupo de perguntas por categoria (AC: 3)
  - [ ] `CategoriaPerguntas` ‚Äî t√≠tulo da categoria + lista de perguntas
  - [ ] 5 categorias com √≠cone diferenciado para cada
  - [ ] Ordenar por `pergunta.ordem`

- [ ] **Task 5:** Implementar auto-save (AC: 5)
  - [ ] Ao selecionar valor no Likert, disparar POST imediato
  - [ ] Otimistic UI: atualizar contador local sem esperar resposta
  - [ ] Indicador visual sutil "Salvando..." / "Salvo"

- [ ] **Task 6:** Criar p√°gina do question√°rio (AC: 1, 6, 8, 10)
  - [ ] `packages/web/app/(dashboard)/diagnostico/questionario/page.tsx`
  - [ ] Barra de progresso global: "Setores completos: X/N"
  - [ ] L√≥gica de navega√ß√£o entre setores
  - [ ] Validar completude antes de permitir avan√ßar para Evid√™ncias

## Dev Notes

### Perguntas do Seed (15 perguntas, 5 categorias)

```typescript
// prisma/seed.ts ‚Äî perguntas psicossociais baseadas na NR-01 e literatura brasileira
const perguntas = [
  // Organiza√ß√£o do Trabalho
  { categoria: 'organizacao_trabalho', ordem: 1, texto: 'Com que frequ√™ncia voc√™ sente que tem trabalho em excesso para realizar no prazo?' },
  { categoria: 'organizacao_trabalho', ordem: 2, texto: 'Com que frequ√™ncia voc√™ tem autonomia para decidir como realizar suas tarefas?' },
  { categoria: 'organizacao_trabalho', ordem: 3, texto: 'Com que frequ√™ncia as metas estabelecidas s√£o realistas e alcan√ß√°veis?' },
  // Rela√ß√µes Interpessoais
  { categoria: 'relacoes_interpessoais', ordem: 4, texto: 'Com que frequ√™ncia voc√™ recebe apoio de seus colegas quando necessita?' },
  { categoria: 'relacoes_interpessoais', ordem: 5, texto: 'Com que frequ√™ncia h√° conflitos n√£o resolvidos entre membros da equipe?' },
  { categoria: 'relacoes_interpessoais', ordem: 6, texto: 'Com que frequ√™ncia voc√™ se sente respeitado(a) pela sua chefia imediata?' },
  // Condi√ß√µes de Trabalho
  { categoria: 'condicoes_trabalho', ordem: 7, texto: 'Com que frequ√™ncia seu ambiente de trabalho oferece condi√ß√µes adequadas (ilumina√ß√£o, temperatura, ru√≠do)?' },
  { categoria: 'condicoes_trabalho', ordem: 8, texto: 'Com que frequ√™ncia voc√™ disp√µe dos recursos necess√°rios para realizar seu trabalho?' },
  { categoria: 'condicoes_trabalho', ordem: 9, texto: 'Com que frequ√™ncia voc√™ consegue equilibrar vida profissional e pessoal?' },
  // Viol√™ncia e Ass√©dio
  { categoria: 'violencia_assedio', ordem: 10, texto: 'Com que frequ√™ncia voc√™ presencia ou vivencia situa√ß√µes de grosseria ou desrespeito no trabalho?' },
  { categoria: 'violencia_assedio', ordem: 11, texto: 'Com que frequ√™ncia voc√™ se sente pressionado(a) de forma excessiva por superiores?' },
  { categoria: 'violencia_assedio', ordem: 12, texto: 'Com que frequ√™ncia voc√™ observa tratamento diferenciado injusto entre colaboradores?' },
  // Reconhecimento e Recompensa
  { categoria: 'reconhecimento_recompensa', ordem: 13, texto: 'Com que frequ√™ncia seu trabalho √© reconhecido e valorizado pela empresa?' },
  { categoria: 'reconhecimento_recompensa', ordem: 14, texto: 'Com que frequ√™ncia voc√™ recebe feedback construtivo sobre seu desempenho?' },
  { categoria: 'reconhecimento_recompensa', ordem: 15, texto: 'Com que frequ√™ncia voc√™ sente que sua remunera√ß√£o √© justa em rela√ß√£o ao trabalho realizado?' },
];
```

> **Nota:** Perguntas de viol√™ncia/ass√©dio: valor alto (4-5) = situa√ß√£o RUIM.
> Perguntas de apoio/reconhecimento: valor baixo (1-2) = situa√ß√£o RUIM.
> A l√≥gica de invers√£o deve ser aplicada no c√°lculo do risco (Story 1.6).

### Auto-save Pattern

```typescript
// Debounce n√£o necess√°rio ‚Äî radio button, 1 click = 1 valor definitivo
const handleResposta = async (perguntaId: string, valor: number) => {
  setRespostas(prev => ({ ...prev, [perguntaId]: valor }));  // optimistic
  await fetch('/api/questionario/resposta', {
    method: 'POST',
    body: JSON.stringify({ setorId, perguntaId, valor }),
  });
};
```

### Arquivos Principais

- `packages/web/app/(dashboard)/diagnostico/questionario/page.tsx`
- `packages/web/components/questionario/LikertScale.tsx`
- `packages/web/components/questionario/CategoriaPerguntas.tsx`
- `packages/web/components/questionario/SetorSelector.tsx`
- `packages/web/app/api/questionario/resposta/route.ts`

## ü§ñ CodeRabbit Integration

> **CodeRabbit Integration**: Disabled

## File List

_A ser preenchido durante implementa√ß√£o_

## Dev Agent Record

### Implementation Notes
_A ser preenchido pelo @dev_

### Completion Checklist
- [ ] Todos os ACs implementados
- [ ] 15 perguntas em 5 categorias exibidas corretamente
- [ ] Auto-save funcionando (sem bot√£o manual)
- [ ] Progresso por setor atualizado em tempo real
- [ ] Status atualizado para Done
