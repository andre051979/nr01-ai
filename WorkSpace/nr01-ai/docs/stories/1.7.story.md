---
id: "1.7"
title: "Plano de A√ß√£o ‚Äî 5W2H por Risco"
epic: 1
story: 7
status: Done
priority: high
type: fullstack
created: 2026-02-25
updated: 2026-02-25
blockedBy: ["1.6"]
---

# Story 1.7: Plano de A√ß√£o ‚Äî 5W2H por Risco

## Status: Done

## Story Statement

Como administrador, quero criar e gerenciar um plano de a√ß√£o no modelo 5W2H para cada risco m√©dio ou alto identificado, definindo respons√°vel, prazo e status de execu√ß√£o, para que a empresa possa controlar as a√ß√µes de mitiga√ß√£o dos riscos psicossociais.

## Acceptance Criteria

- [x] **AC1:** P√°gina `/plano-acao` acess√≠vel ap√≥s aprova√ß√£o da avalia√ß√£o
- [x] **AC2:** Apenas riscos de classifica√ß√£o **m√©dio** ou **alto** geram plano de a√ß√£o
- [x] **AC3:** Para cada risco, formul√°rio 5W2H com os campos: What, Why, Who, Where, When (datepicker), How, How Much (opcional)
- [x] **AC4:** Campo de status por a√ß√£o: "N√£o iniciado", "Em andamento", "Conclu√≠do"
- [x] **AC5:** Possibilidade de adicionar m√∫ltiplas a√ß√µes para o mesmo risco
- [x] **AC6:** Indicador de progresso: "X riscos com plano definido / Y total"
- [x] **AC7:** Filtro de riscos por: setor, classifica√ß√£o (m√©dio/alto), status da a√ß√£o
- [x] **AC8:** Todos os campos obrigat√≥rios validados (exceto How Much e Where)
- [x] **AC9:** Cada a√ß√£o tem "Salvar a√ß√£o" individual (sem salvar global)
- [x] **AC10:** Bot√£o "Gerar Relat√≥rio" dispon√≠vel quando todos os riscos t√™m pelo menos 1 a√ß√£o

## Tasks / Subtasks

- [x] **Task 1:** API Routes de Plano de A√ß√£o
  - [x] `GET /api/plano-acao` ‚Äî riscos medio/alto com planos
  - [x] `POST /api/plano-acao` ‚Äî cria a√ß√£o
  - [x] `PUT /api/plano-acao/[id]` ‚Äî atualiza a√ß√£o
  - [x] `DELETE /api/plano-acao/[id]` ‚Äî remove a√ß√£o

- [x] **Task 2:** `PlanoAcaoForm` ‚Äî 7 campos 5W2H + status, react-hook-form + Zod
- [x] **Task 3:** `RiscoPlanoCard` ‚Äî card com lista de a√ß√µes, edi√ß√£o/remo√ß√£o inline
- [x] **Task 4:** `FiltrosPlano` ‚Äî selects de setor, classifica√ß√£o, status (client-side)
- [x] **Task 5:** P√°gina `/plano-acao` com progresso e bot√£o "Gerar Relat√≥rio"
- [x] **Task 6:** Zod Schema de valida√ß√£o com separa√ß√£o raw/output types

## File List

- `packages/web/app/api/plano-acao/route.ts` ‚Äî GET + POST
- `packages/web/app/api/plano-acao/[id]/route.ts` ‚Äî PUT + DELETE
- `packages/web/components/plano-acao/PlanoAcaoForm.tsx`
- `packages/web/components/plano-acao/RiscoPlanoCard.tsx`
- `packages/web/components/plano-acao/FiltrosPlano.tsx`
- `packages/web/app/(dashboard)/plano-acao/page.tsx`

## ü§ñ CodeRabbit Integration

> **CodeRabbit Integration**: Disabled

## Dev Agent Record

### Implementation Notes
- `howMuchCusto` usa raw string no formul√°rio (react-hook-form) e converte para number no submit
- Filtro de status filtra riscos que tenham ao menos 1 a√ß√£o com aquele status
- `RiscoPlanoCard` destacado em laranja quando sem a√ß√µes
- date-fns/ptBR para formata√ß√£o de datas na lista

### Completion Checklist
- [x] Todos os ACs implementados
- [x] Apenas riscos m√©dio/alto aparecem
- [x] 5W2H completo com valida√ß√£o
- [x] Status atualizado em tempo real
- [x] Filtros funcionando
- [x] Status atualizado para Done
