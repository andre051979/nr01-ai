---
id: "1.7"
title: "Plano de A√ß√£o ‚Äî 5W2H por Risco"
epic: 1
story: 7
status: Draft
priority: high
type: fullstack
created: 2026-02-25
updated: 2026-02-25
blockedBy: ["1.6"]
---

# Story 1.7: Plano de A√ß√£o ‚Äî 5W2H por Risco

## Status: Draft

## Story Statement

Como administrador, quero criar e gerenciar um plano de a√ß√£o no modelo 5W2H para cada risco m√©dio ou alto identificado, definindo respons√°vel, prazo e status de execu√ß√£o, para que a empresa possa controlar as a√ß√µes de mitiga√ß√£o dos riscos psicossociais.

## Acceptance Criteria

- [ ] **AC1:** P√°gina `/plano-acao` acess√≠vel ap√≥s aprova√ß√£o da avalia√ß√£o
- [ ] **AC2:** Apenas riscos de classifica√ß√£o **m√©dio** ou **alto** geram plano de a√ß√£o
- [ ] **AC3:** Para cada risco, formul√°rio 5W2H com os campos: What (a√ß√£o), Why (justificativa), Who (respons√°vel), Where (local/√°rea), When (prazo - datepicker), How (como executar), How Much (custo estimado, opcional)
- [ ] **AC4:** Campo de status por a√ß√£o: "N√£o iniciado", "Em andamento", "Conclu√≠do"
- [ ] **AC5:** Possibilidade de adicionar m√∫ltiplas a√ß√µes para o mesmo risco (bot√£o "+ Adicionar A√ß√£o")
- [ ] **AC6:** Indicador de progresso: "X riscos com plano definido / Y total"
- [ ] **AC7:** Filtro de riscos por: setor, classifica√ß√£o (m√©dio/alto), status da a√ß√£o
- [ ] **AC8:** Todos os campos obrigat√≥rios (exceto How Much e Where) validados antes de salvar
- [ ] **AC9:** A√ß√µes salvas automaticamente (sem bot√£o "Salvar" global ‚Äî cada a√ß√£o tem "Salvar a√ß√£o")
- [ ] **AC10:** Bot√£o "Gerar Relat√≥rio" dispon√≠vel quando pelo menos 1 a√ß√£o est√° definida para cada risco m√©dio/alto

## Tasks / Subtasks

- [ ] **Task 1:** Criar API Routes de Plano de A√ß√£o (AC: 3, 4, 9)
  - [ ] `GET /api/plano-acao?empresaId=X` ‚Äî lista todos os planos com riscos
  - [ ] `POST /api/plano-acao` ‚Äî cria nova a√ß√£o para risco espec√≠fico
  - [ ] `PUT /api/plano-acao/:id` ‚Äî atualiza a√ß√£o (incluindo status)
  - [ ] `DELETE /api/plano-acao/:id` ‚Äî remove a√ß√£o
  - [ ] Valida√ß√£o Zod para todos os campos

- [ ] **Task 2:** Criar componente de formul√°rio 5W2H (AC: 3, 8)
  - [ ] `PlanoAcaoForm` ‚Äî 7 campos organizados em grid 2 colunas
  - [ ] Campos obrigat√≥rios marcados com asterisco
  - [ ] DatePicker para campo When (prazo)
  - [ ] Select para status com badges coloridos:
    - "N√£o iniciado" ‚Üí cinza
    - "Em andamento" ‚Üí azul
    - "Conclu√≠do" ‚Üí verde
  - [ ] Valida√ß√£o inline com react-hook-form + Zod

- [ ] **Task 3:** Criar componente de card de risco com planos (AC: 2, 5)
  - [ ] `RiscoPlanoCard` ‚Äî header com dados do risco (classifica√ß√£o badge, setor, descri√ß√£o)
  - [ ] Lista de a√ß√µes j√° criadas
  - [ ] Bot√£o "+ Adicionar A√ß√£o" ‚Üí abre formul√°rio 5W2H inline ou drawer
  - [ ] A√ß√£o individual com bot√£o editar e remover (com confirma√ß√£o)

- [ ] **Task 4:** Criar filtros (AC: 7)
  - [ ] Barra de filtros: Select de Setor, Select de Classifica√ß√£o, Select de Status
  - [ ] Filtros aplicados client-side (sem recarregar)
  - [ ] Chip de filtro ativo com bot√£o "limpar"

- [ ] **Task 5:** Criar p√°gina Plano de A√ß√£o (AC: 1, 6, 10)
  - [ ] `packages/web/app/(dashboard)/plano-acao/page.tsx`
  - [ ] Header com progresso: "X/Y riscos com a√ß√µes definidas"
  - [ ] Aviso se risco sem nenhuma a√ß√£o (highlight em vermelho)
  - [ ] Bot√£o "Gerar Relat√≥rio" habilitado conforme AC10

- [ ] **Task 6:** Zod Schema de valida√ß√£o (AC: 8)

```typescript
const planoAcaoSchema = z.object({
  whatAcao: z.string().min(10, 'Descreva a a√ß√£o (m√≠nimo 10 caracteres)'),
  whyJustif: z.string().min(10, 'Descreva a justificativa'),
  whoResponsavel: z.string().min(3, 'Informe o respons√°vel'),
  whereLocal: z.string().optional(),
  whenPrazo: z.date({ required_error: 'Prazo √© obrigat√≥rio' }),
  howExecucao: z.string().min(10, 'Descreva como ser√° executado'),
  howMuchCusto: z.number().positive().optional(),
  status: z.enum(['nao_iniciado', 'em_andamento', 'concluido']),
});
```

## Dev Notes

### Depend√™ncias Adicionais

```bash
npm install react-day-picker date-fns
```

### Estrutura de Dados da P√°gina

```typescript
interface RiscoComPlanos {
  risco: {
    id: string;
    descricao: string;
    setor: { nome: string };
    classificacao: 'medio' | 'alto';
    probabilidade: string;
    severidade: string;
  };
  planos: PlanoAcao[];
}
```

### Layout do Formul√°rio 5W2H

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ WHAT ‚Äî O que ser√° feito?          [textarea] ‚îÇ
‚îÇ WHY  ‚Äî Por que ser√° feito?        [textarea] ‚îÇ
‚îÇ WHO  ‚Äî Quem √© o respons√°vel?      [input]   ‚îÇ
‚îÇ WHERE‚Äî Em qual √°rea/local?        [input]   ‚îÇ
‚îÇ WHEN ‚Äî Qual o prazo?              [date]    ‚îÇ
‚îÇ HOW  ‚Äî Como ser√° executado?       [textarea] ‚îÇ
‚îÇ HOW $ ‚Äî Custo estimado? (opcional)[number]  ‚îÇ
‚îÇ Status: [N√£o iniciado ‚ñº]                    ‚îÇ
‚îÇ                          [Cancelar][Salvar] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Arquivos Principais

- `packages/web/app/(dashboard)/plano-acao/page.tsx`
- `packages/web/components/plano-acao/PlanoAcaoForm.tsx`
- `packages/web/components/plano-acao/RiscoPlanoCard.tsx`
- `packages/web/components/plano-acao/FiltrosPlano.tsx`
- `packages/web/app/api/plano-acao/route.ts`
- `packages/web/app/api/plano-acao/[id]/route.ts`

## ü§ñ CodeRabbit Integration

> **CodeRabbit Integration**: Disabled

## File List

_A ser preenchido durante implementa√ß√£o_

## Dev Agent Record

### Implementation Notes
_A ser preenchido pelo @dev_

### Completion Checklist
- [ ] Todos os ACs implementados
- [ ] Apenas riscos m√©dio/alto aparecem
- [ ] 5W2H completo com valida√ß√£o
- [ ] Status atualizado em tempo real
- [ ] Filtros funcionando
- [ ] Status atualizado para Done
